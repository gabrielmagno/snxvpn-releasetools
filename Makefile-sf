MKCHLOG=../make/mkchlog.py
README=README
NOTES=notes
CHANGES=changes
RELEASE:=$(shell echo $(LASTRELEASE) | sed -e 's/^V_//' -e 's/_/./g')

$(NOTES): $(README)
	$(MKCHLOG) $(NOTES) < README > $@

$(CHANGES): $(README)
	$(MKCHLOG) $(CHANGES) < README > $@

upload: all $(CHANGES) $(NOTES) dist
	@echo Preparing Release $(RELEASE)
	@echo -n Password:
	@read -s pw &&                                                     \
	copher.pl --user $(USERNAME) --password $$pw --project $(PROJECT) \
	    --package $(PACKAGE) --release $(RELEASE) --notes $(NOTES) \
	    --changelog $(CHANGES) dist/*

FOCUS:=$(shell $(MKCHLOG) sf-release-focus < README)
URL:=$(shell python setup.py --url)
LICENSE:=$(shell python setup.py --license | sed 's/Library or //')
FRESHMEAT=freshmeat-submit
#FRESHMEAT=cat

announce: all $(CHANGES) $(NOTES) dist
	 ( echo "Project: $(PROJECT)"    \
	 ; echo "Version: $(RELEASE)" \
	 ; echo "Release-Focus: $(FOCUS)" \
	 ; if [ -n "$(URL)"     ] ; then echo "Home-Page-URL: $(URL)" ; fi \
	 ; if [ -n "$(LICENSE)" ] ; then echo "License: $(LICENSE)"   ; fi \
	 ; echo ""                       \
	 ; cat $(NOTES)                  \
	 ) | $(FRESHMEAT)

license:
	@echo "$(LICENSE)"

version:
	@echo "$(RELEASE)"
